<!-- /docs/index.html â€” Astrocast Sky Panel (themed from logo colors) -->
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>The Astrocast â€” Tonightâ€™s Sky</title>
<style>
  /* Theme from the image: deep space bg, neon cyan, hot pink, purple, peach */
  :root{
    --bg:#070912;          /* near-black navy */
    --panel:#0e1021;       /* card base */
    --ink:#eaf2ff;         /* main text */
    --muted:#a9b4d4;       /* secondary text */
    --cyan:#7de2ff;        /* neon cyan */
    --pink:#ff6bc8;        /* hot pink */
    --violet:#7a5cff;      /* purple accent */
    --peach:#ff8a5c;       /* waveform warm accent */
    --glow: 0 0 16px rgba(125,226,255,.45);
  }

  html,body{height:100%;margin:0;background:radial-gradient(1200px 800px at 70% -10%, #0f1630 0%, var(--bg) 55%);color:var(--ink);font:16px/1.55 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;}
  .wrap{max-width:980px;margin:0 auto;padding:20px 16px 28px;}
  .brand{display:flex;align-items:baseline;gap:10px;margin:4px 0 16px}
  .brand .tiny{font-weight:700;color:var(--pink);text-shadow:0 0 10px rgba(255,107,200,.35)}
  .brand h1{margin:0;font-weight:900;letter-spacing:.3px;font-size:1.9rem;
    color:var(--cyan); text-shadow:var(--glow);}
  .pill{margin-left:auto;display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;background:rgba(125,226,255,.10);color:var(--cyan);font-weight:700;border:1px solid rgba(125,226,255,.25)}
  .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:14px}
  .card{grid-column:span 12;background:
      linear-gradient(180deg,rgba(14,16,33,.95),rgba(7,9,18,.95)),
      radial-gradient(600px 200px at 100% -10%, rgba(122,92,255,.18), transparent 60%),
      radial-gradient(500px 200px at 0% 110%, rgba(255,138,92,.10), transparent 60%);
    border:1px solid rgba(255,255,255,.06);border-radius:18px;padding:14px 14px 16px;
    box-shadow:0 8px 30px rgba(0,0,0,.38)}
  @media(min-width:720px){ .card.sm{grid-column:span 4} .card.md{grid-column:span 6} .card.lg{grid-column:span 12} }
  .card h2{margin:.2rem 0 .5rem 0;color:var(--muted);font-size:1rem;font-weight:700}
  .big{font-size:2.2rem;font-weight:900;letter-spacing:.3px}
  .row{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
  .muted{color:var(--muted)}
  .list{list-style:none;margin:.25rem 0 0 0;padding:0}
  .list li{padding:8px 0;border-top:1px dashed rgba(255,255,255,.08)}
  a{color:var(--cyan)}
  .spinner{width:18px;height:18px;border:3px solid rgba(255,255,255,.15);border-top-color:var(--pink);border-radius:50%;animation:spin 1s linear infinite}
  @keyframes spin{to{transform:rotate(360deg)}}
  .err{color:#ff9aa2}
  .accent{color:var(--pink)}
</style>
</head>
<body>
  <div class="wrap">
    <div class="brand">
      <span class="tiny">The</span>
      <h1>Astrocast</h1>
      <span class="pill" id="loc-pill"><span class="spinner"></span> Getting locationâ€¦</span>
    </div>

    <div class="grid">
      <div class="card sm">
        <h2>Cloud Cover</h2>
        <div class="big" id="cloudCover">â€”</div>
        <div class="muted" id="cloudNote">Current total cloud (%)</div>
      </div>

      <div class="card sm">
        <h2>Moon Phase</h2>
        <div class="big" id="moonPhase">â€”</div>
        <div class="muted" id="moonIllum">â€”</div>
      </div>

      <div class="card sm">
        <h2>Conditions</h2>
        <div class="row">
          <div><strong id="tempNow">â€”</strong> <span class="muted">Â°F</span></div>
          <div><strong id="precipNow">â€”</strong> <span class="muted">mm/h</span></div>
        </div>
        <div class="muted">Temperature & precip (current)</div>
      </div>

      <div class="card md">
        <h2>Next ISS Pass</h2>
        <div id="issInfo">Calculatingâ€¦ <span class="spinner"></span></div>
        <div class="muted">Computed locally from latest TLEs.</div>
      </div>

      <div class="card md">
        <h2>Upcoming Astronomy Events</h2>
        <ul class="list" id="eventsList"><li>Loadingâ€¦</li></ul>
        <div class="muted">Auto-filtered to the next few weeks.</div>
      </div>

      <div class="card lg">
        <h2>3 Targets for Tonight</h2>
        <ul class="list" id="targetsList"><li>Picking for your latitude/dateâ€¦</li></ul>
        <div class="muted">Wide/medium-field friendly picks.</div>
      </div>
    </div>

    <div class="muted" style="margin-top:10px">Data: Open-Meteo (no key). ISS via CelesTrak + satellite.js. All times local.</div>
  </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/satellite.js/1.3.0/satellite.min.js" defer></script>
<script>
(async function(){
  const $ = id => document.getElementById(id);
  const clamp = (v,min,max)=>Math.max(min,Math.min(max,v));
  const toF = c => Math.round((c * 9/5) + 32);
  const fmtTime = d => d.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});

  // Geolocation (fallback: Charlotte, NC)
  const getPos = () => new Promise(resolve=>{
    if(!navigator.geolocation) return resolve({coords:{latitude:35.2271, longitude:-80.8431}});
    navigator.geolocation.getCurrentPosition(
      p=>resolve(p),
      _=>resolve({coords:{latitude:35.2271, longitude:-80.8431}}),
      {enableHighAccuracy:true, timeout:7000, maximumAge:0}
    );
  });
  const pos = await getPos();
  const lat = +pos.coords.latitude.toFixed(4);
  const lon = +pos.coords.longitude.toFixed(4);
  $("loc-pill").innerHTML = `ðŸ“ ${lat}, ${lon}`;

  // Weather (Open-Meteo)
  try{
    const url = new URL("https://api.open-meteo.com/v1/forecast");
    url.search = new URLSearchParams({
      latitude: lat, longitude: lon,
      current: "temperature_2m,precipitation,cloud_cover",
      hourly: "cloud_cover,precipitation",
      forecast_days: 1, timezone: "auto"
    }).toString();

    const wx = await fetch(url).then(r=>r.json());
    const cur = wx.current || {};
    const cloud = Math.round(cur.cloud_cover ?? wx.hourly?.cloud_cover?.[0] ?? 0);
    const tempF = toF(cur.temperature_2m ?? NaN);
    const prec = (cur.precipitation ?? NaN);

    $("cloudCover").textContent = `${clamp(cloud,0,100)}%`;
    $("tempNow").textContent = isFinite(tempF) ? tempF : "â€”";
    $("precipNow").textContent = isFinite(prec) ? prec.toFixed(2) : "â€”";
  }catch(e){
    $("cloudNote").innerHTML = `<span class="err">Weather fetch failed</span>`;
  }

  // Moon phase (local calc)
  function moonPhaseInfo(date=new Date()){
    const synodic = 29.530588853;
    const knownNew = new Date(Date.UTC(2000,0,6,18,14));
    const days = (date - knownNew)/86400000;
    const phase = (days % synodic + synodic) % synodic;
    const illum = (1 - Math.cos(2*Math.PI*phase/synodic)) / 2;
    let label="";
    const p=phase;
    if (p < 1.84566) label = "New Moon";
    else if (p < 5.53699) label = "Waxing Crescent";
    else if (p < 9.22831) label = "First Quarter";
    else if (p < 12.91963) label = "Waxing Gibbous";
    else if (p < 16.61096) label = "Full Moon";
    else if (p < 20.30228) label = "Waning Gibbous";
    else if (p < 23.99361) label = "Last Quarter";
    else if (p < 27.68493) label = "Waning Crescent";
    else label = "New Moon";
    return {label, illum: Math.round(illum*100)};
  }
  const mp = moonPhaseInfo();
  $("moonPhase").textContent = mp.label;
  $("moonIllum").textContent = `${mp.illum}% illuminated`;

  // Next ISS pass (satellite.js + CelesTrak TLE)
  async function nextISSPass(lat, lon){
    const tle = await fetch("https://celestrak.org/NORAD/elements/gp.php?CATNR=25544&FORMAT=TLE").then(r=>r.text());
    const lines = tle.trim().split(/\r?\n/).slice(-2);
    const satrec = satellite.twoline2satrec(lines[0], lines[1]);

    const obs = {
      latitude: satellite.degreesToRadians(lat),
      longitude: satellite.degreesToRadians(lon),
      height: 0.2
    };

    const start = new Date();
    const end = new Date(start.getTime() + 24*60*60*1000);
    const step = 30*1000;

    function altAt(t){
      const gmst = satellite.gstime(t);
      const pv = satellite.propagate(satrec, t);
      if(!pv.position) return null;
      const ecf = satellite.eciToEcf(pv.position, gmst);
      const aa = satellite.ecfToLookAngles(obs, ecf);
      return { el: aa.elevation, when: new Date(t) };
    }

    for(let t=+start; t<=+end; t+=step){
      const a = altAt(new Date(t));
      if(!a) continue;
      if(satellite.radiansToDegrees(a.el) > 20){
        // refine peak
        let peak=a, tt=t;
        for(let j=0;j<40;j++){
          tt += 15*1000;
          const b = altAt(new Date(tt));
          if(!b) break;
          if(b.el > peak.el) peak=b;
        }
        return {
          start:new Date(t),
          peak:peak.when,
          peakEl: Math.round(satellite.radiansToDegrees(peak.el))
        };
      }
    }
    return null;
  }

  try{
    const pass = await nextISSPass(lat,lon);
    $("issInfo").innerHTML = pass
      ? `Starts ~ <strong class="accent">${fmtTime(pass.start)}</strong>, peak <strong class="accent">${fmtTime(pass.peak)}</strong> at <strong class="accent">${pass.peakEl}Â°</strong>`
      : `No pass >20Â° in the next 24h.`;
  }catch(e){
    $("issInfo").innerHTML = `<span class="err">ISS pass calc failed</span>`;
  }

  // Events (2025 highlights â†’ next few)
  const events2025 = [
    {date:"2025-08-12", name:"Perseids Meteor Shower Peak"},
    {date:"2025-09-21", name:"Partial Lunar Eclipse (Americas)"},
    {date:"2025-10-06", name:"Draconids Peak"},
    {date:"2025-10-22", name:"Orionids Peak"},
    {date:"2025-11-17", name:"Leonids Peak"},
    {date:"2025-12-14", name:"Geminids Peak"}
  ];
  const today = new Date();
  const soon = events2025
    .map(e=>({ ...e, when:new Date(e.date+"T12:00:00")}))
    .filter(e=>e.when >= today)
    .sort((a,b)=>a.when-b.when)
    .slice(0,5);
  $("eventsList").innerHTML = soon.length
    ? soon.map(e=>`<li><strong>${e.name}</strong> â€” ${e.when.toLocaleDateString()}</li>`).join("")
    : `<li>No major listed events soon.</li>`;

  // Targets for tonight (simple month picks for N mid-lat)
  const month = new Date().getMonth()+1;
  const picksByMonth = {
    7:["Lagoon Nebula (M8)","Trifid Nebula (M20)","Eagle Nebula (M16)"],
    8:["Andromeda Galaxy (M31)","North America Nebula (NGC 7000)","Veil Nebula (NGC 6960/6992)"],
    9:["Andromeda Galaxy (M31)","Triangulum Galaxy (M33)","Pacman Nebula (NGC 281)"],
    10:["Pacman Nebula (NGC 281)","Heart & Soul Nebulae","Pleiades (M45)"]
  };
  const fallback = ["Milky Way Scutum Star Cloud","Small Sagittarius Star Cloud (M24)","Sadr Region (IC 1318)"];
  const picks = picksByMonth[month] || fallback;
  $("targetsList").innerHTML = picks.map(t=>`<li>${t}</li>`).join("");
})();
</script>
</body>
</html>
